
@{
    ViewBag.Title = "Account List";
}
<!-- Content Header (Page header) -->
<section class="content-header">
    <h1>
        Master
        <small>Accounts</small>
    </h1>
    <ol class="breadcrumb">
        <li><a href="/"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active">Accounts</li>
    </ol>
</section>
<!-- Main content -->
<section class="content">
    <div id="data-list" class="box">
        <div class="box-header with-border">
            <h3 class="box-title">Account List</h3>
            <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip"
                        title="Collapse">
                    <i class="fa fa-minus"></i>
                </button>
                <button type="button" class="btn btn-box-tool" data-widget="remove" data-toggle="tooltip" title="Remove">
                    <i class="fa fa-times"></i>
                </button>
            </div>
        </div>
        <div class="box-body">
            <div id="grid-account"></div>
        </div>
        <!-- /.box-body -->
        <div class="box-footer text-right">
            <button id="btn-add" type="button" class="btn btn-primary"><i class="fa fa-plus"></i> Add New</button>
        </div>
        <!-- /.box-footer-->
    </div>
    <!-- /.box -->
    <div id="data-detail" class="box" style="display: none">
        <form name="form1">
            <div class="box-header with-border">
                <h3 class="box-title">Account Detail</h3>
                <div class="box-tools pull-right">
                    <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip"
                            title="Collapse">
                        <i class="fa fa-minus"></i>
                    </button>
                    <button type="button" class="btn btn-box-tool" data-widget="remove" data-toggle="tooltip" title="Remove">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="box-body">
                <div class="form-horizontal">
                    <div class="form-group">
                        <div class="col-md-2 control-label">Account ID</div>
                        <div class="col-md-3">
                            <input data-bind="AccountID" type="text" name="AccountID" class="form-control" />
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-2 control-label">Account Type</div>
                        <div class="col-md-3">
                            <input data-bind="AccountType" type="text" name="AccountType" class="form-control" />
                        </div>
                        <div class="col-md-2 control-label">First Name</div>
                        <div class="col-md-3">
                            <input data-bind="FirstName" type="text" name="FirstName" class="form-control" />
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-2 control-label">Last Name</div>
                        <div class="col-md-3">
                            <input data-bind="LastName" type="text" name="LastName" class="form-control" />
                        </div>
                        <div class="col-md-2 control-label">Place Of Birth</div>
                        <div class="col-md-3">
                            <input data-bind="PlaceOfBirth" type="text" name="PlaceOfBirth" class="form-control" />
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-2 control-label">Date Of Birth</div>
                        <div class="col-md-3">
                            <input data-bind="DateOfBirth" type="text" name="DateOfBirth" class="form-control" />
                        </div>
                        <div class="col-md-2 control-label">Mother Name</div>
                        <div class="col-md-3">
                            <input data-bind="MotherName" type="text" name="MotherName" class="form-control" />
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-2 control-label">IDNumber</div>
                        <div class="col-md-3">
                            <input data-bind="IDNumber" type="text" name="IDNumber" class="form-control" />
                        </div>
                        <div class="col-md-2 control-label">Address</div>
                        <div class="col-md-3">
                            <input data-bind="Address" type="text" name="Address" class="form-control" />
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-2 control-label">City</div>
                        <div class="col-md-3">
                            <input data-bind="City" type="text" name="City" class="form-control" />
                        </div>
                        <div class="col-md-2 control-label">State</div>
                        <div class="col-md-3">
                            <input data-bind="State" type="text" name="State" class="form-control" />
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-2 control-label">Postal Code</div>
                        <div class="col-md-3">
                            <input data-bind="PostalCode" type="text" name="PostalCode" class="form-control" />
                        </div>
                        <div class="col-md-2 control-label">Country</div>
                        <div class="col-md-3">
                            <input data-bind="Country" type="text" name="Country" class="form-control" />
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-2 control-label">Email</div>
                        <div class="col-md-3">
                            <input data-bind="Email" type="email" name="Email" class="form-control" />
                        </div>
                        <div class="col-md-2 control-label">Phone</div>
                        <div class="col-md-3">
                            <input data-bind="Phone" type="text" name="Phone" class="form-control" />
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-2 control-label">Password</div>
                        <div class="col-md-3">
                            <input data-bind="Password" type="password" name="Password" class="form-control" />
                        </div>
                        <div class="col-md-2 control-label">Status</div>
                        <div class="col-md-3">
                            <input data-bind="Status" type="text" name="Status" class="form-control" />
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-2 control-label">Register Date</div>
                        <div class="col-md-3">
                            <input data-bind="RegisterDate" type="text" name="RegisterDate" class="form-control" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="box-footer text-center">
                <button id="btn-back" type="button" class="btn btn-default"><i class="fa fa-chevron-left"></i> Back</button>
                <button id="btn-save" type="button" class="btn btn-primary"><i class="fa fa-save"></i> Save</button>
            </div>
        </form>
    </div>
</section>
<!-- /.content-->

@section scripts
{ 
<script>
    (function () {
        function Account() {
            return {
                AccountID: 0,
                AccountType: '',
                FirstName: '',
                LastName: '',
                PlaceOfBirth: '',
                DateOfBirth: '',
                MotherName: '',
                IDNumber: '',
                Address: '',
                City: '',
                State: '',
                PostalCode: '',
                Country: '',
                Email: '',
                Phone: '',
                Password: '',
                Status: '',
                RegisterDate: '',
                LastModifiedDate: '2019-06-27 14:15:04.440'
            }
        }
        var scope = (function () {
            return Bind({
                account: new Account()
            }, {
                    "account.AccountID": "[data-bind='AccountID']",
                    "account.AccountType": "[data-bind='AccountType']",
                    "account.FirstName": "[data-bind='FirstName']",
                    "account.LastName": "[data-bind='LastName']",
                    "account.PlaceOfBirth": "[data-bind='PlaceOfBirth']",
                    "account.DateOfBirth": "[data-bind='DateOfBirth']",
                    "account.MotherName": "[data-bind='MotherName']",
                    "account.IDNumber": "[data-bind='IDNumber']",
                    "account.Address": "[data-bind='Address']",
                    "account.City": "[data-bind='City']",
                    "account.State": "[data-bind='State']",
                    "account.PostalCode": "[data-bind='PostalCode']",
                    "account.Country": "[data-bind='Country']",
                    "account.Email": "[data-bind='Email']",
                    "account.Phone": "[data-bind='Phone']",
                    "account.Password": "[data-bind='Password']",
                    "account.Status": "[data-bind='Status']",
                    "account.RegisterDate": "[data-bind='RegisterDate']"
                });
        }());
        var state = "new";
        var grid = gridview("grid-account", {
            url: "/Account/Paging",
            columns: [
                {
                    text: "", render: function (c) {
                        var tmpl = "<a action='view'><i class='fa fa-search'></i></a>";
                        tmpl += "<a action='edit'><i class='fa fa-edit'></i></a>";
                        tmpl += "<a action='remove'><i class='fa fa-trash'></i></a>";
                        return tmpl;
                    }
                },
                { field: "AccountID", text: "Account ID", sortable: true },
                { field: "FirstName", text: "First tName", sortable: true },
                { field: "Email", text: "Email", sortable: true },
                { field: "DateOfBirth", text: "Date Of Birth", sortable: true },
                { field: "IDNumber", text: "ID Number", sortable: true },
                { field: "Address", text: "Address", sortable: true },
                { field: "City", text: "City", sortable: true },
                { field: "Status", text: "Status", sortable: true }
            ],
            fieldKey: "AccountID",
            view: view,
            edit: edit,
            remove: remove
        });

        function view(acc) {
            scope.account = acc;
            showDetail();
            $("[data-bind]").attr("disabled", true);
            $("#btn-save").hide();
        }

        function edit(acc) {
            state = "update";
            scope.account = acc;
            showDetail();
            $("[data-bind]").attr("disabled", false);
            $("[data-bind='AccountID']").attr("disabled", true);
            $("#btn-save").show();
        }

        function addNew() {
            state = "new";
            scope.account = new Account();
            showDetail();
            $("[data-bind]").attr("disabled", false);
            $("#btn-save").show();
        }

        function remove(acc) {
            Swal.fire({
                title: "Confirmation",
                text: "Are you sure?",
                type: "warning",
                showCancelButton: true,
                confirmButtonText: "YES",
                cancelButtonText: "NO",
                confirmButtonColor: "red"
            })
                .then(function (r) {
                    if (r.value) {
                        axios.post("/Account/Delete", { id: acc.AccountID })
                            .then(function (res) { return res.data; }, function (err) { console.log("Err: ", er); })
                            .then(function (res) {
                                if (res.meta.success) {
                                    Swal.fire("Success", "Delete data success", "success")
                                        .then(function (r) {
                                            grid.reload();
                                        });
                                } else {
                                    Swal.fire("Error", res.meta.message, "error");
                                }
                            });
                    }
                })
        }

        function showDetail() {
            $("#data-list").fadeOut(250, function () { $("#data-detail").fadeIn(500) });
        }

        function showList() {
            $("#data-detail").fadeOut(250, function () { $("#data-list").fadeIn(500) });
        }

        function save() {
            var url = "/Account/" + (state === "new" ? "Insert" : "Update");

            axios.post(url, { account: scope.account })
                .then(function (res) { return res.data; }, function (err) { console.log("Err: ", er); })
                .then(function (res) {
                    if (res.meta.success) {
                        Swal.fire("Success", "Save data success", "success")
                            .then(function (r) {
                                showList();
                                grid.reload();
                            });
                    } else {
                        Swal.fire("Error", res.meta.message, "error");
                    }
                });
        }

        $("#btn-add").click(addNew);
        $("#btn-back").click(function () { showList(); });
        $("#btn-save").click(save);
    }());
</script>
}